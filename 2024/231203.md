# 한달동안의 커밋 기록, 작업 내역 회고

## 메인 서버

### 코드 파일 구조 개선

- MVC 패턴에 맞게 로직단에 모델단을 통합 (queries 제거)

### 타입스크립트 도입

- types 브랜치 도입
  - 각 기능 별 타입을 정의
- 타입 정의
  - 테이블 별 스키마 타이핑
  - 외부 모듈 (DL 서버, 상세 조회 API)의 response에 대한 타이핑
  - 함수 간 파라미터 및 return 값에 대한 타이핑
- util 개선
  - 알약 검색 쿼리 필터를 만드는 로직 개선
- 초기세팅 코드 제거
  - 라이브러리가 타입스크립트를 지원하지 않아서 제거
  - 차후 초기 세팅 개선 예정

### 메인 서버 초기 세팅 개선

- 설계
  - 타입스크립트를 지원하는 csv 및 xlsx 라이브러리 사용 (두 형식을 모두 지원하는)
    - (1) 메인 서버 실행 시 MAIN_SERVER_PATH/res 내 디렉터리에 파일들이 존재하는지 확인
      - drug_permission / pill_recognition
    - (2) 있으면 파일들을 읽어서 비동기로 upsert 처리 (기존 데이터가 있으면 UPDATE, 없으면 INSERT)
    - (3) 업데이트 완료 후 resource들을 다른 디렉터리로 이동 (서버 관리자가 알아서 삭제)
- 현황
  - 초기 세팅 개념 대신 데이터베이스 업데이트로 대체
  - 로더 로직 개선 및 엑셀 데이터를 json으로 변환하기 위한 mapper 도입
- 계획
  - xls 파일을 읽는 라이브러리가 타입스크립트를 지원하지 않아서 직접 구현 예정
  - 직접 구현하면 npm에 올릴 예정

### CICD 로직 설계

#### 깃허브 액션 (hosted runner 활용)

- (1) release 브랜치에 push 발생
- (2) scp를 통해 배포 서버로 모듈 전달
  - RSA 키로 인증
- (3) ssh로 배포 서버의 쉘 파일 실행
  - RSA 키로 인증

#### 젠킨스 (배포 서버에 위치)

- (1) release 브랜치에 push 발생
- (2) release 브랜치 clone
- (3) 쉘 파일 실행

## 딥러닝 서버

### 모델 개선

- 싱글 클래스를 기반으로 학습
- 1.8 테라 용량의 이미지를 학습하는데 오래 걸림
- 지금까지는 5%의 이미지만 가지고 상태
- 이미지의 상태가 좋지는 않지만 loss를 줄이고 좀 더 개선할 예정
- 전이학습이나 fine tuning을 통해서 모델을 개선할 예정
- 실패할 경우 resnet을 backbone으로 하는 rcnn 모델을 사용할 예정

## 애플리케이션

### IOS 연동

- IOS 개발을 위해 개발 환경 설정
- IOS 실행 하려다가 빌드 과정에서 오류 발생
  - RN 버전이 X-Code 버전과 맞지 않아서 RN 버전 업데이트 필요
  - 0.71.4 ~ 0.71.6
- IOS에서 지원 안되는 코드가 있어서 수정

### 디자인

- 로고디자인 초안 작성

# 앞으로 한달동안 작업할 내용

## 인프라

- CICD 도입
- 딥러닝 서버 멀티스테이지 빌드 도입
- 커밋 메시지 템플릿 도입 (인스펙션 당일)

## 메인 서버

- 스웨거 도입 (API 문서)
  - 딥러닝 서버에 대한 API 데이터 포맷 확정
- 데이터베이스 리소스 업데이트 기능 작업 (기존 초기 세팅)
  - xls parser를 직접 구현 (typescript-xls-parser)
  - xlsx 및 csv는 exceljs 이용 예정 (xls에 대한 작업 이후)

## 딥러닝 서버

- API 설계서 나오면 수정
- 알약 인식 모델 개발
- 색상 인식 기능 구현
- 글자 인식 구현
  - 모델 변경 필요

## 애플리케이션

- 디렉터리 작업
  - iOS에 대해 번들링이 안되는 문제 해결
- 디자인 (피그마)
  - 로고 디자인
  - UI 디자인
- 기능 명세서

# 새로운 이슈 공유

## 메인 서버
- 상세 검색 API가 우리도 모르게 바뀔 수 있음
  - 상세 검색 없엘까? (고려중)
  - DB 저장으로 대체

# 새로운 제안

## 코드 리뷰 문화 도입

- (0) 모두 fork 브랜치 생성 후 로컬에 clone (인스펙션 당일)
- (1) fork 브랜치를 clone
- (2) 작업 시 작업 브랜치를 생성하여 작업
- (3) 작업 완료 후 main 브랜치에 merge request
- (4) Asignee로 지정된 개발자가 로직, 코드 구조 등에 대해 리뷰
