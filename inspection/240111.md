# 한달동안의 커밋 기록, 작업 내역 회고

## 김종연

## 황진태

### 이미지 내의 알약 여부 판별 모델 훈련

#### 모델

- [Yolov8](https://github.com/ultralytics/ultralytics)
  - yolov8s : 작은 크기 모델 => 약 20mb
  - yolov8m : 중간 크기 모델 => 약 50mb
  - yolov8l : 큰 크기 모델 => 약 70~100mb

#### 데이터셋 ([알약 데이터](https://www.aihub.or.kr/aihubdata/data/view.do?currMenu=&topMenu=&aihubDataSe=data&dataSetSn=576))

- 단일 알약 이미지
  | class | 개수 |
  |:---|:---:|
  | 원형 | 433512 |
  | 팔각형 | 11664 |
  | 타원형 | 360071 |
  | 장방형 | 422280 |
  | 삼각형 | 17070 |
  | 기타 | 28512 |
  | 사각형 | 9936 |
  | 마름모형 | 3024 |
  | 오각형 | 10152 |
  | 육각형 | 11664 |
  | 반원형 | 1296 |

#### 1차

- yolov8s, yolov8m 사용 => 결과는 yolov8m이 정확도가 약간 더 높음, 문제는 동일
- batch_size : 8
- epoch : 100
- 이미지 크기 : 640
- optimizer : SGD
- **데이터** : 각 class 별 **2000**개 사용 / 반원형의 경우 1200개
  - 테스트 이미지 정확도 : 약 **87 %**
- **실사용** : 웹캠을 이용한 알약 인식
  - 정확도는 측정이 어려울 정도로 낮음

#### 1차 결과

- 이미지 중앙에 알약이 위치한 이미지의 경우 잘 인식함
- **타원형, 장방형**의 구분이 **어려움**
- **반원형** 인식 **어려움**
- 알약이 아닌 이미지를 인식
  - 원형, 타원형 등 **도형 형태**의 이미지를 알약으로 인식하는 문제 발생 **ex) 전등, 시계 등**
  - 비슷함 여부의 상관없이 **잘린 이미지**를 인식하는 문제 발생 **ex) 사각형 물체의 둥근 모서리, 사람의 팔꿈치 등**

#### 2차

- 1차 이후 변경사항
  - **타원형, 장방형** class **통합**
  - **close_mosaic == epoch**로 설정하여 잘라진 형태의 이미지 학습x
    - 기본적으로 yolo는 **임의 이미지**들을 **재구성**하여 학습에 사용함, 해당 과정에서 **다양한 형태의 객체**를 학습함 => 해당 과정 중 이미지의 **객체가 잘리지 않게 설정**
- yolov8s, yolov8m 사용
- batch_size, epoch, 이미지 크기, optimizer : 1차와 동일
- **데이터** : 각 class 별 **2000**개 / 반원형 1200개 / 타원,장방 통합
  - 테스트 이미지 정확도 : 약 **97 %**
- **실사용** : 웹캠을 이용한 알약 인식
  - 정확도 : 약 **10 %**

#### 2차 결과

- **타원, 장방형** 정확도 상승 => 테스트 이미지 정확도 **100 %**
- 반원형 정확도 : 1차와 동일
- 알약이 아닌 이미지 정확도
  - 원형, 타원형 등 **도형 형태**의 인식율 : 1차와 **동일**
  - 비슷함 여부의 상관없는 **잘린 이미지** 인식율 : 매우 **감소**

#### 3차

- 2차 이후 변경사항
  - 알약만 인식하게 **single_cls** 옵션 추가
    - 모든 class를 **1개**로 인식 => 원형, 타원, 오각 등을 알약이라는 1개의 classs로 인식하게 설정
- yolov8s, yolov8m 사용
- batch_size, epoch, 이미지 크기, optimizer, close_mosaic : 2차와 동일
- **데이터** : class 통합 **21200**개
  - 테스트 이미지 정확도 : 약 **97 %**
- **실사용** : 웹캠을 이용한 알약 인식
  - 정확도 : 2차와 **동일**

#### 3차 결과

- **테스트** : 2차와 **변화없음** => 반원 인식 문제
- **실사용** : 2차보다 약간 **감소** => 문제는 동일

#### 4차

- 3차 이후 변경사항
  - **single_cls** 옵션 삭제
  - 옵션을 **2차와 동일**하게 설정
  - **yolov8l** 모델을 사용
- 모든 설정 **2차와 동일**
- **데이터** : **2차와 동일**
  - 테스트 이미지 정확도 : 약 **97 %**
- **실사용**
  - 정확도 : 2차와 동일 => **변화 없음**

#### 4차 결과

- 2차와 동일함

#### 5차

- 4차 이후 변경사항
  - **imagenet** 데이터 추가 => not_pill class로 설정
  - close_mosaic 옵션 삭제
  - class를 2개로 구분 => **pill / not_pill**
- yolov8s, yolov8m 모델 사용
- 모든 설정 **2차와 동일**
- **데이터** : 알약 데이터 : **21200**개 / 알약이 아닌 데이터 : **21200**개
  - 테스트 이미지 정확도 : 약 **85 %**
- **실사용** :
  - 정확도 : 약 **35 %**

#### 5차 결과

- 반원형 인식 문제 개선
- **타원, 장방형** 인식 문제 발생 => 테스트 이미지와 관련된 **학습 데이터 부족 문제**로 판단됨
- **도형 형태**의 이미지 인식 문제 개선 => 도형 형태 인식율 **감소**

### 통합 결과

- 알약 인식 **여부**만 **판별**하는 모델과 알약의 형태를 **구분**하는 모델로 분할하여 서비스 **프로세스**를 개선할 필요가 있음
- 학습 데이터 **부족** : 현재 가지고 있는 알약 데이터는 **형태 구분**(classification)에 **적합**한 것 같음
- 알약의 특징을 잘 학습할 수 있는 모델로 교체가 필요해 보임

## 용시훈

- 스웨거 도입 (API 문서)
  - 나중을 위해 자동화를 시키려고 생각중
  - 라이브러리가 데코레이터를 사용하는데, 클래스 구조로 리팩토링을 해볼까 고려중

# 앞으로 한달동안 작업할 내용

## 황진태

- 5차에 close_mosaic 옵션을 적용해 학습 예정
- 학습 데이터를 추가하여 학습 예정
- 테스트용 앱을 제작해 알약 여부 인식 모델을 테스트할 예정(실사용)

## 용시훈

- 코드 컴플리트를 읽고 메인 서버의 구조를 리팩토링
  - 스웨거 자동화 라이브러리가 데코레이터를 사용하는데, 타입스크립트 데코레이터 및 OOP에 대해 공부

# 새로운 이슈 공유

# 새로운 제안

## 용시훈

- MBM 회비로 도서 구입 지원?
  - 다 읽고 중고로 팔아서 환수
